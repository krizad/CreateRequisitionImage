<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>สร้างใบขอซื้อ</title>

    <!-- icon -->
    <link rel="icon" href="./image/favicon.ico" type="image/x-icon">

    <!-- bootstrap 5 -->
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.0.0-beta1/css/bootstrap.min.css">

    <!-- jq -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <!-- html2canvas -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"
        integrity="sha512-BNaRQnYJYiPSqHHDb58B0yaPfCu+Wgds8Gp/gU33kqBtgNS4tSPHuGibyoeqMV/TJlSKda6FXzoEyYGjTe+vXA=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>


</head>

<style>
    body {
        font-size: 16px;
    }

    .center {
        /* center middle */
        text-align: center;
        vertical-align: middle;
    }

    .logo {
        width: 200px;
        height: 70px;
    }

    .only-text {
        border: none;
        background-color: transparent !important;
    }

    .capture {
        width: 100%;
        height: 100%;
        border: 1px solid black;
        /* padding-top: 50px; */
        padding: 5rem 3rem 3rem 3rem;
    }

    .transparent-input {
        border: none;
        border-bottom: 1px dotted black;
        background-color: transparent !important;
        border-radius: 0;
        padding: 0 0 0 15px;
    }

    #capture {
        overflow-x: visible;
    }

    table {
        width: 100vw;
    }

    table,
    table th,
    table td {
        border: 1px solid black;
        border-collapse: collapse;
        text-wrap: nowrap;
    }
</style>



<body>

    <div class="container-fluid">
        <div class="mt-3 mb-2 d-flex justify-content-start">
            <button type="button" name="" id="downloadImage" class="btn btn-success me-2">ดาวน์โหลดรูปภาพ</button>
            <!-- <button type="button" name="" id="" class="btn btn-success" onclick="shareToLine()">ส่งรูปผ่านไลน์</button> -->

        </div>

        <div id="capture" class="">
            <table class="table">
                <thead>
                    <tr>
                        <td class="center p-0" colspan="3" rowspan="3" scope="col">
                            <img class="logo" src="./image/logo.png">
                        </td>
                        <th class="center" colspan="4" rowspan="3" scope="col">ใบขอซื้อ <br>PURCHASE REQUISTION</th>
                        <td colspan="3" scope="col">
                            <div class="d-flex justify-content-start align-items-end">
                                <div class="">วันที่</div>
                                <div class="w-100">
                                    <input type="text" class="form-control transparent-input" name="" id="">
                                </div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="3" scope="col">
                            <div class="d-flex justify-content-start align-items-end">
                                <div class="">เลขที่ PR.CM</div>
                                <div class="w-100">
                                    <input type="text" class="form-control transparent-input" name="" id="">
                                </div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="3" scope="col">
                            <div class="d-flex justify-content-start align-items-end">
                                <div class="">เลขที่ PO</div>
                                <div class="w-100">
                                    <input type="text" class="form-control transparent-input" name="" id="">
                                </div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="7" scope="col">
                            <div class="d-flex justify-content-start align-items-end">
                                <div class="">ฝ่าย/แผนกที่ขอซื้อ</div>
                                <div class="w-100">
                                    <input type="text" class="form-control transparent-input" name="" id="">
                                </div>
                            </div>
                        </td>
                        <td colspan="3" scope="col">
                            <div class="d-flex justify-content-start align-items-end">
                                <div class="">วันที่รับของ</div>
                                <div class="w-100">
                                    <input type="text" class="form-control transparent-input" name="" id="">
                                </div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="10" scope="col">


                            <div class="d-flex justify-content-start align-items-end" style="width:fit-content">
                                <div class="">ประเภทการสั่งซื้อ </div>
                                <div class=""><span class="select">( ) </span>วัสดุก่อสร้าง</div>
                                <div class=""><span class="select">( ) </span>ทรัพย์สิน</div>
                                <div class=""><span class="select">( ) </span>อื่นๆ</div>
                                <div class="">
                                    <input type="text" class="form-control transparent-input" name="" id="">
                                </div>
                            </div>

                        </td>
                    </tr>
                    <tr class="">
                        <td colspan="9">โครงการ
                            <span class="select">( ) </span>เดอะนาราเพอร์เฟค2
                            <span class="select">( ) </span>เดอะนารามาสเตอร์พีช
                            <span class="select">( ) </span>เดอะนาราน็อตติ้งฮิลล์
                            <span class="select">( ) </span>เดอะไพร์วี่ ทาวน์ แอดเดรส
                            <span class="select">( ) </span>เดอะไพร์วี่ เนเจอร์2<br>
                            <span class="select">( ) </span>เดอะไพร์วี่ ครอฟท์2
                            <span class="select">( ) </span>เดอะไพร์วี่ นอร์ดิก
                            <span class="select">( ) </span>เดอะไพร์วี่ แกรนด์ นอร์ดิก
                            <span class="select">( ) </span>เดอะไพร์วี่4ค็อกเทจ
                            <span class="select">( ) </span>เดอะไพร์วี่ 5 ค็อกเทจ<br>
                            <div class="d-flex justify-content-start align-items-end">
                                <div class="">ผู้รับเหมา</div>
                                <div class="">
                                    <input type="text" class="form-control transparent-input" name="" id="">
                                </div>
                                <div class="">แปลงที่</div>
                                <div class="">
                                    <input type="text" class="form-control transparent-input" name="" id="">
                                </div>
                                <div class="">ประจำงวดที่</div>
                                <div class="">
                                    <input type="text" class="form-control transparent-input" name="" id="">
                                </div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <th class="center" scope="col">ลำดับ</th>
                        <th class="center" scope="col">รหัสสินค้า</th>
                        <th class="center" colspan="5" scope="col">รายการ</th>
                        <th class="center" scope="col">จำนวน</th>
                        <th class="center" scope="col">หน่วย</th>
                    </tr>
                </thead>
                <tbody>
                    <datalist id="idListOption">
                    </datalist>
                    <datalist id="nameListOption">
                    </datalist>

                    <!-- row1 -->
                    <tr id="row1">
                        <td class="center" style="width: 1%;" scope="row">
                            <input type="text" class="form-control only-text" name="" id="order1" placeholder="ลำดับ"
                                value="1" disabled>
                        </td>
                        <td style="width: 10%;">
                            <input type="text" class="form-control" list="idListOption" name="id" id="id1"
                                placeholder="รหัสสินค้า">

                        </td>
                        <td colspan="5" style="width: 20%;">
                            <input type="textarea" style="height:500px;" class="form-control" list="nameListOption" name="name" id="name1"
                                placeholder="รายการ" >
                        </td>
                        <td class="center" style="width: 10%;">
                            <input type="text" class="form-control " name="amount" id="amount1" placeholder="จำนวน">
                        </td>
                        <td class="center" style="width: 10%;">
                            <input type="text" class="form-control" name="unit" id="unit1" placeholder="หน่วย">
                        </td>
                    </tr>
                    <!-- row2 -->
                    <tr id="row2">
                        <td class="center" style="width: 1%;" scope="row">
                            <input type="text" class="form-control only-text" name="" id="order2" placeholder="ลำดับ"
                                value="2" disabled>
                        </td>
                        <td style="width: 10%;">
                            <input type="text" class="form-control" list="idListOption" name="id" id="id2"
                                placeholder="รหัสสินค้า">
                        </td>
                        <td colspan="5" style="width: 20%;">
                            <input type="text" class="form-control" list="nameListOption" name="name" id="name2"
                                placeholder="รายการ">
                        </td>
                        <td class="center" style="width: 10%;">
                            <input type="text" class="form-control" name="amount" id="amount2" placeholder="จำนวน">
                        </td>
                        <td class="center" style="width: 10%;">
                            <input type="text" class="form-control" name="unit" id="unit2" placeholder="หน่วย">
                        </td>
                    </tr>
                    <!-- row3 -->
                    <tr id="row3">
                        <td class="center" style="width: 1%;" scope="row">
                            <input type="text" class="form-control only-text" name="" id="order3" placeholder="ลำดับ"
                                value="3" disabled>
                        </td>
                        <td style="width: 10%;">
                            <input type="text" class="form-control" list="idListOption" name="id" id="id3"
                                placeholder="รหัสสินค้า">
                        </td>
                        <td colspan="5" style="width: 20%;">
                            <input type="text" class="form-control" list="nameListOption" name="name" id="name3"
                                placeholder="รายการ">
                        </td>
                        <td class="center" style="width: 10%;">
                            <input type="text" class="form-control" name="amount" id="amount3" placeholder="จำนวน">
                        </td>
                        <td class="center" style="width: 10%;">
                            <input type="text" class="form-control" name="unit" id="unit3" placeholder="หน่วย">
                        </td>
                    </tr>

                    <!-- row4 -->
                    <tr id="row4">
                        <td class="center" style="width: 1%;" scope="row">
                            <input type="text" class="form-control only-text" name="" id="order4" placeholder="ลำดับ"
                                value="4" disabled>
                        </td>
                        <td style="width: 10%;">
                            <input type="text" class="form-control" list="idListOption" name="id" id="id4"
                                placeholder="รหัสสินค้า">
                        </td>
                        <td colspan="5" style="width: 20%;">
                            <input type="text" class="form-control" list="nameListOption" name="name" id="name4"
                                placeholder="รายการ">
                        </td>
                        <td class="center" style="width: 10%;">
                            <input type="text" class="form-control" name="amount" id="amount4" placeholder="จำนวน">
                        </td>
                        <td class="center" style="width: 10%;">
                            <input type="text" class="form-control" name="unit" id="unit4" placeholder="หน่วย">
                        </td>
                    </tr>

                    <tr id="row5">
                        <td class="center" style="width: 1%;" scope="row">
                            <input type="text" class="form-control only-text" name="" id="order5" placeholder="ลำดับ"
                                value="5" disabled>
                        </td>
                        <td style="width: 10%;">
                            <input type="text" class="form-control" list="idListOption" name="id" id="id5"
                                placeholder="รหัสสินค้า">
                        </td>
                        <td colspan="5" style="width: 20%;">
                            <input type="text" class="form-control" list="nameListOption" name="name" id="name5"
                                placeholder="รายการ">
                        </td>
                        <td class="center" style="width: 10%;">
                            <input type="text" class="form-control" name="amount" id="amount5" placeholder="จำนวน">
                        </td>
                        <td class="center" style="width: 10%;">
                            <input type="text" class="form-control" name="unit" id="unit5" placeholder="หน่วย">
                        </td>
                    </tr>

                    <tr id="row6">
                        <td class="center" style="width: 1%;" scope="row">
                            <input type="text" class="form-control only-text" name="" id="order6" placeholder="ลำดับ"
                                value="6" disabled>
                        </td>
                        <td style="width: 10%;">
                            <input type="text" class="form-control" list="idListOption" name="id" id="id6"
                                placeholder="รหัสสินค้า">
                        </td>
                        <td colspan="5" style="width: 20%;">
                            <input type="text" class="form-control" list="nameListOption" name="name" id="name6"
                                placeholder="รายการ">
                        </td>
                        <td class="center" style="width: 10%;">
                            <input type="text" class="form-control" name="amount" id="amount6" placeholder="จำนวน">
                        </td>
                        <td class="center" style="width: 10%;">
                            <input type="text" class="form-control" name="unit" id="unit6" placeholder="หน่วย">
                        </td>
                    </tr>

                    <tr id="row7">
                        <td class="center" style="width: 1%;" scope="row">
                            <input type="text" class="form-control only-text" name="" id="order7" placeholder="ลำดับ"
                                value="7" disabled>
                        </td>
                        <td style="width: 10%;">
                            <input type="text" class="form-control" list="idListOption" name="id" id="id7"
                                placeholder="รหัสสินค้า">
                        </td>
                        <td colspan="5" style="width: 20%;">
                            <input type="text" class="form-control" list="nameListOption" name="name" id="name7"
                                placeholder="รายการ">
                        </td>
                        <td class="center" style="width: 10%;">
                            <input type="text" class="form-control" name="amount" id="amount7" placeholder="จำนวน">
                        </td>
                        <td class="center" style="width: 10%;">
                            <input type="text" class="form-control" name="unit" id="unit7" placeholder="หน่วย">
                        </td>
                    </tr>

                    <tr id="row8">
                        <td class="center" style="width: 1%;" scope="row">
                            <input type="text" class="form-control only-text" name="" id="order8" placeholder="ลำดับ"
                                value="8" disabled>
                        </td>
                        <td style="width: 10%;">
                            <input type="text" class="form-control" list="idListOption" name="id" id="id8"
                                placeholder="รหัสสินค้า">
                        </td>
                        <td colspan="5" style="width: 20%;">
                            <input type="text" class="form-control" list="nameListOption" name="name" id="name8"
                                placeholder="รายการ">
                        </td>
                        <td class="center" style="width: 10%;">
                            <input type="text" class="form-control" name="amount" id="amount8" placeholder="จำนวน">
                        </td>
                        <td class="center" style="width: 10%;">
                            <input type="text" class="form-control" name="unit" id="unit8" placeholder="หน่วย">
                        </td>
                    </tr>

                    <tr id="row9">
                        <td class="center" style="width: 1%;" scope="row">
                            <input type="text" class="form-control only-text" name="" id="order9" placeholder="ลำดับ"
                                value="9" disabled>
                        </td>
                        <td style="width: 10%;">
                            <input type="text" class="form-control" list="idListOption" name="id" id="id9"
                                placeholder="รหัสสินค้า">
                        </td>
                        <td colspan="5" style="width: 20%;">
                            <input type="text" class="form-control" list="nameListOption" name="name" id="name9"
                                placeholder="รายการ">
                        </td>
                        <td class="center" style="width: 10%;">
                            <input type="text" class="form-control" name="amount" id="amount9" placeholder="จำนวน">
                        </td>
                        <td class="center" style="width: 10%;">
                            <input type="text" class="form-control" name="unit" id="unit9" placeholder="หน่วย">
                        </td>
                    </tr>

                    <tr id="row10">
                        <td class="center" style="width: 1%;" scope="row">
                            <input type="text" class="form-control only-text" name="" id="order10" placeholder="ลำดับ"
                                value="10" disabled>
                        </td>
                        <td style="width: 10%;">
                            <input type="text" class="form-control" list="idListOption" name="id" id="id10"
                                placeholder="รหัสสินค้า">
                        </td>
                        <td colspan="5" style="width: 20%;">
                            <input type="text" class="form-control" list="nameListOption" name="name" id="name10"
                                placeholder="รายการ">
                        </td>
                        <td class="center" style="width: 10%;">
                            <input type="text" class="form-control" name="amount" id="amount10" placeholder="จำนวน">
                        </td>
                        <td class="center" style="width: 10%;">
                            <input type="text" class="form-control" name="unit" id="unit10" placeholder="หน่วย">
                        </td>
                    </tr>

                </tbody>
                <tfoot>
                    <tr>
                        <td class="center" colspan="3" rowspan="3" scope="col">
                            ผู้ขอซื้อ<br>
                            <div class="d-flex justify-content-center">
                                <input type="text" class="w-50 form-control transparent-input" name="" id="">
                            </div><br>
                            ............/............./............<br>
                        </td>
                        <td class="center" colspan="2" rowspan="3" scope="col">
                            หัวหน้าฝ่าย<br>
                            ..........................................<br>
                            ............/............./............<br>
                        </td>
                        <td class="center" colspan="3" rowspan="3" scope="col">
                            ผู้อนุมัติ<br>
                            ..........................................<br>
                            ............/............./............<br>
                        </td>
                        <td class="center" colspan="2" rowspan="3" scope="col">
                            ฝ่ายจัดซื้อ<br>
                            ..........................................<br>
                            ............/............./............<br></td>
                    </tr>
                </tfoot>
            </table>
        </div>

    </div>

</body>

<script>

    var product = [];
    //read csv file
    function readTextFile(file) {
        var rawFile = new XMLHttpRequest();
        let dataCsv = [];
        //product = {id:id,name:name,unit:unit}

        rawFile.open("GET", file, false);
        rawFile.onreadystatechange = function () {
            if (rawFile.readyState === 4) {
                if (rawFile.status === 200 || rawFile.status == 0) {
                    var allText = rawFile.responseText;
                    dataCsv = allText.split("\n");
                    for (let i = 0; i < dataCsv.length; i++) {
                        //remove spacial character
                        let temp = dataCsv[i].split(",");
                        let id = temp[0];
                        let name = temp[1];
                        let unit = temp[2];

                        if (id == "" || name == "" || unit == "") {
                            continue;
                        }

                        product[i] = { id: id, name: name, unit: unit };
                    }
                }
            }
        }
        rawFile.send(null);
    }

    function getNameById(id) {
        for (let i = 0; i < product.length; i++) {
            if (id == product[i].id) {
                return product[i].name;
            }
        }
    }

    function getUnitById(id) {
        for (let i = 0; i < product.length; i++) {
            if (id == product[i].id) {
                return product[i].unit;
            }
        }
    }

    function getIdByName(name) {
        for (let i = 0; i < product.length; i++) {
            if (name == product[i].name) {
                return product[i].id;
            }
        }
    }

    function getUnitByName(name) {
        for (let i = 0; i < product.length; i++) {
            if (name == product[i].name) {
                return product[i].unit;
            }
        }
    }

    readTextFile("product.csv");



    //fill data in select option
    for (let i = 0; i < product.length; i++) {

        $("#idListOption").append("<option value='" + product[i].id + "'>" + product[i].id + "</option>");
        $("#nameListOption").append("<option value='" + product[i].name + "'>" + product[i].name + "</option>");
    }

    $("input[name=id]").change(function () {
        let id = $(this).val();
        let name = getNameById(id);
        let unit = getUnitById(id);
        $(this).parent().next().children().val(name);
        $(this).parent().next().next().next().children().val(unit);
    });

    $("input[name=name]").change(function () {
        let name = $(this).val();
        let id = getIdByName(name);
        let unit = getUnitByName(name);
        $(this).parent().prev().children().val(id);
        $(this).parent().next().next().children().val(unit);
    });


    $("input").attr("autocomplete", "off");

    $("input[name=amount],input[name=unit]").addClass("center");

    $("input").attr("placeholder", " ");
    $(".select").html("( )");
    $(".select").click(function () {
        if ($(this).html() == "( )") {
            $(this).html("(/)");
        } else {
            $(this).html("( )");
        }
    });

    async function createImgLink() {

        let link;

        $("input").addClass("only-text");
        $("#capture").addClass("capture");

        html2canvas(document.querySelector("#capture")).then(canvas => {
            link = document.createElement('a');
            link.download = 'request.png';
            link.href = canvas.toDataURL()

        });

        $("input").removeClass("only-text");
        $("#capture").removeClass("capture");

        return link;

    }

    $("#downloadImage").click(function () {
        $("input").addClass("only-text");
        $("#capture").addClass("capture");

        html2canvas(document.querySelector("#capture")).then(canvas => {
            link = document.createElement('a');
            link.download = 'request.png';
            link.href = canvas.toDataURL()
            link.click();
        });

        $("input").removeClass("only-text");
        $("#capture").removeClass("capture");
    });

    function shareToLine() {
        // Image URL that you want to share
        var imageUrl = createImgLink().href;

        // Line URL scheme for sharing an image
        var lineUrl = "line://msg/image/" + encodeURIComponent(imageUrl);

        // Open the Line app if available, otherwise open the Line web page
        window.location.href = lineUrl;
    }
</script>

</html>